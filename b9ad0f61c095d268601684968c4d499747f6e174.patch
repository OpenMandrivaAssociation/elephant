From b9ad0f61c095d268601684968c4d499747f6e174 Mon Sep 17 00:00:00 2001
From: Andrej Benz <hello@benz.dev>
Date: Thu, 2 Oct 2025 19:04:02 +0200
Subject: [PATCH] fix: clipboard crashing when history file is empty

---
 cmd/elephant/version.txt              | 2 +-
 internal/providers/clipboard/setup.go | 8 ++------
 2 files changed, 3 insertions(+), 7 deletions(-)

diff --git a/cmd/elephant/version.txt b/cmd/elephant/version.txt
index 3a3cd8c..1892b92 100644
--- a/cmd/elephant/version.txt
+++ b/cmd/elephant/version.txt
@@ -1 +1 @@
-1.3.1
+1.3.2
diff --git a/internal/providers/clipboard/setup.go b/internal/providers/clipboard/setup.go
index 2a7eee0..ac5d990 100644
--- a/internal/providers/clipboard/setup.go
+++ b/internal/providers/clipboard/setup.go
@@ -31,7 +31,7 @@ var (
 	file             = common.CacheFile("clipboard.gob")
 	imgTypes         = make(map[string]string)
 	config           *Config
-	clipboardhistory map[string]*Item
+	clipboardhistory = make(map[string]*Item)
 	mu               sync.Mutex
 	imagesOnly       = false
 )
@@ -98,8 +98,6 @@ func loadFromFile() {
 				slog.Error("history", "decoding", err)
 			}
 		}
-	} else {
-		clipboardhistory = map[string]*Item{}
 	}
 }
 
@@ -388,9 +386,7 @@ func Activate(_ uint32, identifier, action string, arguments string) {
 		mu.Unlock()
 	case ActionRemoveAll:
 		mu.Lock()
-		for k := range clipboardhistory {
-			delete(clipboardhistory, k)
-		}
+		clipboardhistory = make(map[string]*Item)
 
 		saveToFile()
 		mu.Unlock()
